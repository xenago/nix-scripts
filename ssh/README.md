# ssh

Useful stuff related to SSH.

## Dealing with host key type error

On some older gear, an error like this will appear:

`no matching host key type found. Their offer: ssh-rsa`

To get around this temporarily, add it to the runtime command, e.g. `ssh -oHostKeyAlgorithms=+ssh-rsa user@server`

Alternatively, add to `~/.ssh/config`:

    Host nas
      HostName server
      HostKeyAlgorithms=+ssh-rsa

## General commands

Generate key (press enter a few times):

    ssh-keygen

Add all `.pub` files in `~/.ssh` to another server for login:

    ssh-copy-id username@server

Authorize a specific public key file on another server:

    ssh-copy-id -i mykey.pub username@server
      > Can use -f to force-add the key even if it already exists
      > Can use -p 22 to use a different port

Import private key from disk:

    cp rsa-private-key-20230321 ~/.ssh/id_rsa
    chmod 600 ~/.ssh/id_rsa

Import public key from disk (e.g. generated by PuTTY):

    mkdir ~/.ssh
    ssh-keygen -i -f rsa-key-20230321.pub >> ~/.ssh/authorized_keys

Import public key from GitHub:

    mkdir ~/.ssh
    curl https://github.com/username.keys >> ~/.ssh/authorized_keys

Use another user's account to SSH into a server and run a command:

    sudo -su user ssh user@server -f 'ls -lah'

## Service commands

Enable SSH login as root (not recommended):

    nano /etc/ssh/sshd_config
      > Update file:
        PermitRootLogin yes
    systemctl restart sshd

Allow RSA SSH key to avoid `key type ssh-rsa not in PubkeyAcceptedAlgorithms` error with OpenSSH:

    sudo nano /etc/ssh/sshd_config.d/custom.conf
      > Update file:
        HostkeyAlgorithms +ssh-rsa
        PubkeyAcceptedAlgorithms +ssh-rsa
        PermitRootLogin yes
    sudo systemctl restart sshd
